<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timeseries Charts</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='raspberry-pi-icon.svg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='charts.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='nav-dock.css') }}">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
</head>
<body>
    <canvas id="matrix-canvas"></canvas>

    <div class="container">
        <h1><span id="hostname-title">timeseries</span> charts</h1>

        <div class="charts-dashboard">
            <!-- Controls Section -->
            <div class="chart-controls">
                <div class="control-group">
                    <label for="timeseries-search">Series Configuration:</label>
                    <div class="search-container">
                        <input
                            type="text"
                            id="timeseries-search"
                            class="timeseries-search-input"
                            placeholder="Search timeseries by name, category, or tags..."
                            autocomplete="off"
                        >
                        <div id="search-results" class="search-results" style="display: none;">
                            <!-- Search results will be dynamically generated -->
                        </div>
                    </div>
                    <div id="selected-series" class="selected-series">
                        <!-- Selected series pills will be displayed here -->
                    </div>
                </div>

                <div class="control-group">
                    <label for="time-range">Time Range:</label>
                    <div class="time-range-controls">
                        <input type="datetime-local" id="start-time" class="time-input">
                        <span class="time-separator">to</span>
                        <input type="datetime-local" id="end-time" class="time-input">
                    </div>
                    <div class="quick-ranges">
                        <button class="quick-range-btn" onclick="setQuickRange(60)">Last Minute</button>
                        <button class="quick-range-btn" onclick="setQuickRange(600)">Last 10 Minutes</button>
                        <button class="quick-range-btn" onclick="setQuickRange(3600)">Last Hour</button>
                        <button class="quick-range-btn" onclick="setQuickRange(21600)">Last 6 Hours</button>
                        <button class="quick-range-btn" onclick="setQuickRange(86400)">Last 24 Hours</button>
                        <button class="quick-range-btn" onclick="setQuickRange(604800)">Last Week</button>
                        <button class="quick-range-btn" onclick="setQuickRange(2678400)">Last Month</button>
                        <button class="quick-range-btn" onclick="setQuickRange(31536000)">Last Year</button>
                    </div>
                </div>

                <div class="control-group">
                    <button class="update-chart-btn" onclick="updateCharts(true)">UPDATE CHARTS</button>
                    <button class="auto-refresh-btn" id="auto-refresh-toggle" onclick="toggleAutoRefresh()">AUTO-REFRESH: OFF</button>
                    <div class="smoothing-control">
                        <span class="toggle-text">SMOOTH LINES:</span>
                        <div class="toggle-switch" id="smoothing-toggle" onclick="toggleSmoothing()">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Container -->
            <div id="charts-container">
                <!-- Charts will be dynamically generated here, grouped by units -->
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeSettingsModal()">&times;</span>
            <div class="modal-header">CHART SETTINGS</div>
            <div class="settings-container">
                <div class="setting-item">
                    <label for="auto-refresh-rate">Chart Auto-Refresh Rate (seconds):</label>
                    <input type="range" id="auto-refresh-rate" min="1" max="300" step="1" value="30">
                    <input type="number" id="auto-refresh-rate-input" min="1" max="300" step="1" value="30" style="width: 80px; margin-left: 10px;"> seconds
                    <div class="setting-description">How often to automatically update charts when auto-refresh is enabled</div>
                </div>

                <div class="setting-item">
                    <label for="max-datapoints">Maximum Datapoints per Chart:</label>
                    <input type="range" id="max-datapoints" min="100" max="100000" step="100" value="10000">
                    <input type="number" id="max-datapoints-input" min="100" max="100000" step="100" value="10000" style="width: 80px; margin-left: 10px;"> points
                    <div class="setting-description">Limit datapoints for better performance. Data will be intelligently downsampled using LTTB algorithm to preserve visual features.</div>
                </div>

                <div class="settings-buttons">
                    <button class="details-btn" onclick="saveSettings()">SAVE</button>
                    <button class="details-btn cancel" onclick="closeSettingsModal()">CANCEL</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Dock -->
    <div class="nav-dock">
        <button class="nav-btn nav-toggle" title="Menu">
            <span class="toggle-icon">‚ò∞</span>
        </button>
        <button class="nav-btn nav-refresh" onclick="updateCharts(true)" title="Refresh Charts">‚ü≥</button>
        <button class="nav-btn nav-settings" onclick="openSettingsModal()" title="Settings">‚öô</button>
        <button class="nav-btn nav-monitor" onclick="navigateTo('/monitor')" title="System Monitor">üì∫</button>
        <button class="nav-btn nav-home" onclick="navigateTo('/')" title="Back to Dashboard">üè†</button>
    </div>

    <script src="{{ url_for('static', filename='dashboard.js') }}"></script>
    <script src="{{ url_for('static', filename='charts.js') }}"></script>
    <script src="{{ url_for('static', filename='nav-dock.js') }}"></script>
</body>
</html>
