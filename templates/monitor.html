<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Monitor</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='raspberry-pi-icon.svg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='monitor.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='nav-dock.css') }}">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
</head>
<body>
    <canvas id="matrix-canvas"></canvas>

    <div class="container">
        <h1><span id="hostname-title">system</span> monitor</h1>

        <div class="monitor-grid">
            <!-- Weather, Time Section -->
            <div class="monitor-card weather-time-card">
                <div class="card-title">WEATHER & TIME</div>
                <div class="weather-container">
                    <div id="weather-info">
                        <div class="weather-temp">--¬∞F</div>
                        <div class="weather-condition">Loading...</div>
                        <div class="weather-location">--</div>
                    </div>
                    <div id="analog-clock">
                        <svg viewBox="0 0 200 200" class="clock-face">
                            <!-- Outer bezel ring -->
                            <circle cx="100" cy="100" r="97" class="clock-bezel-outer"/>
                            <circle cx="100" cy="100" r="95" class="clock-circle"/>
                            <circle cx="100" cy="100" r="93" class="clock-bezel-inner"/>

                            <!-- Minute tick marks (60 total) -->
                            <g class="clock-ticks">
                                <!-- Minor ticks (every minute except 5-min marks) -->
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(6deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(12deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(18deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(24deg)"/>
                                <!-- 5-min major tick at 30deg (1 o'clock) -->
                                <line x1="100" y1="8" x2="100" y2="18" class="tick-major" style="transform: rotate(30deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(36deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(42deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(48deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(54deg)"/>
                                <!-- 5-min major tick at 60deg (2 o'clock) -->
                                <line x1="100" y1="8" x2="100" y2="18" class="tick-major" style="transform: rotate(60deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(66deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(72deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(78deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(84deg)"/>
                                <!-- 5-min major tick at 90deg (3 o'clock) -->
                                <line x1="100" y1="8" x2="100" y2="20" class="tick-quarter" style="transform: rotate(90deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(96deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(102deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(108deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(114deg)"/>
                                <!-- 5-min major tick at 120deg (4 o'clock) -->
                                <line x1="100" y1="8" x2="100" y2="18" class="tick-major" style="transform: rotate(120deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(126deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(132deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(138deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(144deg)"/>
                                <!-- 5-min major tick at 150deg (5 o'clock) -->
                                <line x1="100" y1="8" x2="100" y2="18" class="tick-major" style="transform: rotate(150deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(156deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(162deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(168deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(174deg)"/>
                                <!-- 5-min major tick at 180deg (6 o'clock) -->
                                <line x1="100" y1="8" x2="100" y2="20" class="tick-quarter" style="transform: rotate(180deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(186deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(192deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(198deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(204deg)"/>
                                <!-- 5-min major tick at 210deg (7 o'clock) -->
                                <line x1="100" y1="8" x2="100" y2="18" class="tick-major" style="transform: rotate(210deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(216deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(222deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(228deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(234deg)"/>
                                <!-- 5-min major tick at 240deg (8 o'clock) -->
                                <line x1="100" y1="8" x2="100" y2="18" class="tick-major" style="transform: rotate(240deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(246deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(252deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(258deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(264deg)"/>
                                <!-- 5-min major tick at 270deg (9 o'clock) -->
                                <line x1="100" y1="8" x2="100" y2="20" class="tick-quarter" style="transform: rotate(270deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(276deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(282deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(288deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(294deg)"/>
                                <!-- 5-min major tick at 300deg (10 o'clock) -->
                                <line x1="100" y1="8" x2="100" y2="18" class="tick-major" style="transform: rotate(300deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(306deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(312deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(318deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(324deg)"/>
                                <!-- 5-min major tick at 330deg (11 o'clock) -->
                                <line x1="100" y1="8" x2="100" y2="18" class="tick-major" style="transform: rotate(330deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(336deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(342deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(348deg)"/>
                                <line x1="100" y1="8" x2="100" y2="14" class="tick-minor" style="transform: rotate(354deg)"/>
                                <!-- 12 o'clock (0deg) - quarter mark -->
                                <line x1="100" y1="8" x2="100" y2="20" class="tick-quarter" style="transform: rotate(0deg)"/>
                            </g>

                            <!-- Clock hands -->
                            <line x1="100" y1="100" x2="100" y2="45" class="clock-hand hour-hand" id="hour-hand"/>
                            <line x1="100" y1="100" x2="100" y2="30" class="clock-hand minute-hand" id="minute-hand"/>
                            <line x1="100" y1="100" x2="100" y2="20" class="clock-hand second-hand" id="second-hand"/>

                            <!-- Center cap (layered for depth) -->
                            <circle cx="100" cy="100" r="8" class="clock-center-outer"/>
                            <circle cx="100" cy="100" r="5" class="clock-center"/>
                            <circle cx="100" cy="100" r="2" class="clock-center-dot"/>
                        </svg>
                    </div>
                </div>
                <div class="digital-time" id="digital-time">--:--:--</div>
                <div class="date-display" id="date-display">--</div>
            </div>

            <!-- Stock Charts Section -->
            <div class="monitor-card stock-card">
                <div class="card-title">
                    STOCK PERFORMANCE (% RETURN)
                    <div class="card-title-controls">
                        <select id="stock-date-range-inline" class="inline-select" onchange="onDateRangeChange(this.value)" title="Date Range">
                            <option value="1w">1W</option>
                            <option value="1m">1M</option>
                            <option value="1y">1Y</option>
                            <option value="5y">5Y</option>
                            <option value="10y">10Y</option>
                            <option value="all">ALL</option>
                        </select>
                    </div>
                </div>
                <div id="stock-chart" class="chart-container"></div>
            </div>

            <!-- Quick Status Section -->
            <div class="monitor-card status-card">
                <div class="card-title">QUICK STATUS</div>
                <div class="status-content">
                    <div class="status-item">
                        <div class="status-label">SERVICE STATUSES</div>
                        <div class="status-indicators" id="service-indicators">
                            <!-- Service LEDs will be dynamically generated -->
                        </div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">UPTIME</div>
                        <div class="status-value" id="uptime-status">--</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">DISK SPACE</div>
                        <div class="status-value" id="disk-status">--</div>
                    </div>
                </div>
            </div>

            <!-- Sensor Data Section -->
            <div class="monitor-card sensor-card">
                <div class="card-title">SENSOR DATA</div>
                <div id="sensor-data" class="sensor-data-container">
                    <div class="sensor-data-empty">No sensors configured. Click ‚öô to add sensors.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Monitor Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeSettingsModal()">&times;</span>
            <div class="modal-header">MONITOR SETTINGS</div>
            <div class="settings-container">
                <!-- Weather Settings Section -->
                <div class="settings-section-title">WEATHER</div>
                <div class="setting-item">
                    <label for="weather-address">LOCATION</label>
                    <input type="text" id="weather-address" placeholder="Enter address or city, state">
                    <div class="setting-hint">Examples: "123 Main St, City, State" or "San Francisco, CA"</div>
                </div>

                <!-- Stock Settings Section -->
                <div class="settings-section-title">STOCKS</div>
                <div class="setting-item">
                    <label for="stock-symbols">SYMBOLS TO TRACK</label>
                    <textarea id="stock-symbols" rows="5" placeholder="Enter stock symbols, one per line&#10;Format: SYMBOL:Display Name&#10;Example: AAPL:Apple Inc"></textarea>
                    <div class="setting-hint">One symbol per line. Use SYMBOL:Name format for custom display names.<br>Index symbols: ^IXIC (NASDAQ), ^DJI (Dow Jones), ^GSPC (S&P 500)</div>
                </div>
                <div class="setting-item">
                    <label for="stock-max-points">MAX STOCK DATA POINTS</label>
                    <input type="number" id="stock-max-points" min="100" max="100000" step="100" value="10000">
                    <div class="setting-hint">Maximum data points per symbol. Uses LTTB downsampling to preserve visual fidelity.</div>
                </div>

                <!-- Sensor Settings Section -->
                <div class="settings-section-title">SENSORS</div>
                <div class="setting-item">
                    <label>SELECT SENSORS TO DISPLAY</label>
                    <div id="sensor-selection-list" class="sensor-selection-list">
                        <div class="loading-text">Loading available sensors...</div>
                    </div>
                    <div class="setting-hint">Select which timeseries to display as sensors. Latest values will be shown.</div>
                </div>
                <div class="setting-item">
                    <label for="sensor-update-interval">SENSOR UPDATE INTERVAL (seconds)</label>
                    <input type="number" id="sensor-update-interval" min="1" max="3600" step="1" value="5">
                    <div class="setting-hint">How often to refresh sensor values (1-3600 seconds).</div>
                </div>

                <div class="settings-buttons">
                    <button class="details-btn" onclick="saveSettings()">SAVE</button>
                    <button class="details-btn secondary" onclick="resetSettings()">RESET</button>
                    <button class="details-btn cancel" onclick="closeSettingsModal()">CANCEL</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Dock -->
    <div class="nav-dock">
        <button class="nav-btn nav-toggle" title="Menu">
            <span class="toggle-icon">‚ò∞</span>
        </button>
        <button class="nav-btn nav-refresh" onclick="refreshPage()" title="Refresh Page">‚ü≥</button>
        <button class="nav-btn nav-settings" onclick="openSettingsModal()" title="Settings">‚öô</button>
        <button class="nav-btn nav-charts" onclick="navigateTo('/charts')" title="View Charts">üìä</button>
        <button class="nav-btn nav-home" onclick="navigateTo('/')" title="Back to Dashboard">üè†</button>
    </div>

    <script src="{{ url_for('static', filename='dashboard.js') }}"></script>
    <script src="{{ url_for('static', filename='monitor.js') }}"></script>
    <script src="{{ url_for('static', filename='nav-dock.js') }}"></script>
</body>
</html>
